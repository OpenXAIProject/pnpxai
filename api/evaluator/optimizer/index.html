
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://openxaiproject.github.io/pnpxai/api/evaluator/optimizer/">
      
      
        <link rel="prev" href="../metrics/">
      
      
        <link rel="next" href="../../../detector/">
      
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.33">
    
    
      
        <title>Optimizer - PnP XAI Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pnpxai.evaluator.optimizer.objectives" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PnP XAI Docs" class="md-header__button md-logo" aria-label="PnP XAI Docs" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PnP XAI Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optimizer
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PnP XAI Docs" class="md-nav__button md-logo" aria-label="PnP XAI Docs" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    PnP XAI Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/experiment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/auto_explanation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auto Explanation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/modality/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modality
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/recommender/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recommender
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/detector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Detector
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Evaluator
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Evaluator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Optimizer
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Optimizer
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives" class="md-nav__link">
    <span class="md-ellipsis">
      objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective" class="md-nav__link">
    <span class="md-ellipsis">
      Objective
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.set_data" class="md-nav__link">
    <span class="md-ellipsis">
      set_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.set_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      set_inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.set_targets" class="md-nav__link">
    <span class="md-ellipsis">
      set_targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.suggestor" class="md-nav__link">
    <span class="md-ellipsis">
      suggestor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.suggestor.suggest" class="md-nav__link">
    <span class="md-ellipsis">
      suggest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.types" class="md-nav__link">
    <span class="md-ellipsis">
      types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.types.OptimizationOutput" class="md-nav__link">
    <span class="md-ellipsis">
      OptimizationOutput
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../detector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Detector
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../recommender/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recommender
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../evaluator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluator
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimizer
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives" class="md-nav__link">
    <span class="md-ellipsis">
      objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective" class="md-nav__link">
    <span class="md-ellipsis">
      Objective
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.set_data" class="md-nav__link">
    <span class="md-ellipsis">
      set_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.set_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      set_inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.objectives.Objective.set_targets" class="md-nav__link">
    <span class="md-ellipsis">
      set_targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.suggestor" class="md-nav__link">
    <span class="md-ellipsis">
      suggestor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.suggestor.suggest" class="md-nav__link">
    <span class="md-ellipsis">
      suggest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.types" class="md-nav__link">
    <span class="md-ellipsis">
      types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pnpxai.evaluator.optimizer.types.OptimizationOutput" class="md-nav__link">
    <span class="md-ellipsis">
      OptimizationOutput
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Optimizer</h1>

<div class="doc doc-object doc-module">



<a id="pnpxai.evaluator.optimizer.objectives"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pnpxai.evaluator.optimizer.objectives.Objective" class="doc doc-heading">
            <code>Objective</code>


</h2>


    <div class="doc doc-contents ">


      <p>A class that encapsulates the logic for evaluating a model's performance using a 
specified explainer, postprocessor, and metric within a given modality. The <code>Objective</code> 
class is designed to be callable and can be used within an optimization framework 
like Optuna to evaluate different configurations of explainers and postprocessors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>explainer</code></td>
            <td>
                  <code><span title="pnpxai.explainers.Explainer">Explainer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The explainer used to generate attributions for the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>postprocessor</code></td>
            <td>
                  <code><span title="pnpxai.explainers.utils.postprocess.PostProcessor">PostProcessor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The postprocessor applied to the attributions generated by the explainer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>metric</code></td>
            <td>
                  <code><span title="pnpxai.evaluator.metrics.base.Metric">Metric</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metric used to evaluate the effectiveness of the postprocessed attributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>modality</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pnpxai.core.modality.modality.Modality" href="../../core/modality/#pnpxai.core.modality.modality.Modality">Modality</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data modality (e.g., image, text) the model and explainer are operating on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>inputs</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pnpxai.core._types.TensorOrTupleOfTensors">TensorOrTupleOfTensors</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data to the model. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>targets</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target labels for the input data. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pnpxai/evaluator/optimizer/objectives.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Objective</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that encapsulates the logic for evaluating a model&#39;s performance using a </span>
<span class="sd">    specified explainer, postprocessor, and metric within a given modality. The `Objective` </span>
<span class="sd">    class is designed to be callable and can be used within an optimization framework </span>
<span class="sd">    like Optuna to evaluate different configurations of explainers and postprocessors.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        explainer (Explainer): </span>
<span class="sd">            The explainer used to generate attributions for the model.</span>
<span class="sd">        postprocessor (PostProcessor): </span>
<span class="sd">            The postprocessor applied to the attributions generated by the explainer.</span>
<span class="sd">        metric (Metric): </span>
<span class="sd">            The metric used to evaluate the effectiveness of the postprocessed attributions.</span>
<span class="sd">        modality (Modality): </span>
<span class="sd">            The data modality (e.g., image, text) the model and explainer are operating on.</span>
<span class="sd">        inputs (Optional[TensorOrTupleOfTensors], optional): </span>
<span class="sd">            The input data to the model. Defaults to None.</span>
<span class="sd">        targets (Optional[Tensor], optional): </span>
<span class="sd">            The target labels for the input data. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">EXPLAINER_KEY</span> <span class="o">=</span> <span class="s1">&#39;explainer&#39;</span>
    <span class="n">POSTPROCESSOR_KEY</span> <span class="o">=</span> <span class="s1">&#39;postprocessor&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">explainer</span><span class="p">:</span> <span class="n">Explainer</span><span class="p">,</span>
        <span class="n">postprocessor</span><span class="p">:</span> <span class="n">PostProcessor</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Metric</span><span class="p">,</span>
        <span class="n">modality</span><span class="p">:</span> <span class="n">Modality</span><span class="p">,</span>
        <span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorOrTupleOfTensors</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explainer</span> <span class="o">=</span> <span class="n">explainer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postprocessor</span> <span class="o">=</span> <span class="n">postprocessor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modality</span> <span class="o">=</span> <span class="n">modality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

    <span class="k">def</span> <span class="nf">set_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the input data for the objective.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            inputs (TensorOrTupleOfTensors): </span>
<span class="sd">                The input data to be used by the explainer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Objective: The updated Objective instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the target labels for the objective.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            targets (Tensor): </span>
<span class="sd">                The target labels corresponding to the input data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Objective: The updated Objective instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets both the input data and target labels for the objective.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            inputs (TensorOrTupleOfTensors): </span>
<span class="sd">                The input data to be used by the explainer.</span>
<span class="sd">            targets (Tensor): </span>
<span class="sd">                The target labels corresponding to the input data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Objective: The updated Objective instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_inputs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_targets</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">Trial</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the objective function within an optimization trial. This method is </span>
<span class="sd">        responsible for selecting the explainer and postprocessor based on the trial </span>
<span class="sd">        suggestions, performing the explanation and postprocessing, and evaluating the </span>
<span class="sd">        results using the specified metric.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial (Trial): </span>
<span class="sd">                The trial object from an optimization framework like Optuna.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The evaluation result of the metric after applying the explainer and </span>
<span class="sd">            postprocessor to the model&#39;s predictions. Returns `nan` if the postprocessed </span>
<span class="sd">            results contain non-countable values like `nan` or `inf`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># suggest explainer</span>
        <span class="n">explainer</span> <span class="o">=</span> <span class="n">suggest</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modality</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">EXPLAINER_KEY</span><span class="p">)</span>

        <span class="c1"># suggest postprocessor</span>
        <span class="n">modalities</span> <span class="o">=</span> <span class="n">format_into_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modality</span><span class="p">)</span>
        <span class="n">is_multi_modal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modalities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">postprocessor</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pp</span><span class="p">,</span> <span class="n">modality</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">format_into_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessor</span><span class="p">),</span>
            <span class="n">modalities</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">force_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">explainer</span><span class="p">,</span> <span class="p">(</span><span class="n">Lime</span><span class="p">,</span> <span class="n">KernelShap</span><span class="p">))</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modality</span><span class="p">,</span> <span class="n">TextModality</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">force_params</span><span class="p">[</span><span class="s1">&#39;pooling_fn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">()</span>
            <span class="n">postprocessor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suggest</span><span class="p">(</span>
                <span class="n">trial</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="n">modality</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="n">generate_param_key</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">POSTPROCESSOR_KEY</span><span class="p">,</span>
                    <span class="n">modality</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">is_multi_modal</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
                <span class="n">force_params</span><span class="o">=</span><span class="n">force_params</span><span class="p">,</span>
            <span class="p">))</span>
        <span class="n">postprocessor</span> <span class="o">=</span> <span class="n">format_out_tuple_if_single</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">postprocessor</span><span class="p">))</span>

        <span class="c1"># Ignore duplicated samples</span>
        <span class="n">states_to_consider</span> <span class="o">=</span> <span class="p">(</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">,)</span>
        <span class="n">trials_to_consider</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">states_to_consider</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">trials_to_consider</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;explainer&#39;</span><span class="p">,</span> <span class="n">explainer</span><span class="p">)</span>
                <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;postprocessor&#39;</span><span class="p">,</span> <span class="n">postprocessor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Explain and postprocess</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
        <span class="n">postprocessed</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">pp</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">pp</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">format_into_tuple</span><span class="p">(</span><span class="n">postprocessor</span><span class="p">),</span>
                <span class="n">format_into_tuple</span><span class="p">(</span><span class="n">attrs</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">isnan</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pp</span><span class="o">.</span><span class="n">isinf</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">postprocessed</span><span class="p">):</span>
            <span class="c1"># Treat a failure as nan</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

        <span class="n">postprocessed</span> <span class="o">=</span> <span class="n">format_out_tuple_if_single</span><span class="p">(</span><span class="n">postprocessed</span><span class="p">)</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">set_explainer</span><span class="p">(</span><span class="n">explainer</span><span class="p">)</span>
        <span class="n">evals</span> <span class="o">=</span> <span class="n">format_into_tuple</span><span class="p">(</span>
            <span class="n">metric</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">postprocessed</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Keep current explainer and postprocessor on trial</span>
        <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;explainer&#39;</span><span class="p">,</span> <span class="n">explainer</span><span class="p">)</span>
        <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;postprocessor&#39;</span><span class="p">,</span> <span class="n">postprocessor</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="o">*</span><span class="n">evals</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">evals</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pnpxai.evaluator.optimizer.objectives.Objective.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Executes the objective function within an optimization trial. This method is 
responsible for selecting the explainer and postprocessor based on the trial 
suggestions, performing the explanation and postprocessing, and evaluating the 
results using the specified metric.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>trial</code></td>
            <td>
                  <code><span title="optuna.trial.Trial">Trial</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trial object from an optimization framework like Optuna.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The evaluation result of the metric after applying the explainer and </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>postprocessor to the model's predictions. Returns <code>nan</code> if the postprocessed </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>results contain non-countable values like <code>nan</code> or <code>inf</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pnpxai/evaluator/optimizer/objectives.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">Trial</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the objective function within an optimization trial. This method is </span>
<span class="sd">    responsible for selecting the explainer and postprocessor based on the trial </span>
<span class="sd">    suggestions, performing the explanation and postprocessing, and evaluating the </span>
<span class="sd">    results using the specified metric.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        trial (Trial): </span>
<span class="sd">            The trial object from an optimization framework like Optuna.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The evaluation result of the metric after applying the explainer and </span>
<span class="sd">        postprocessor to the model&#39;s predictions. Returns `nan` if the postprocessed </span>
<span class="sd">        results contain non-countable values like `nan` or `inf`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># suggest explainer</span>
    <span class="n">explainer</span> <span class="o">=</span> <span class="n">suggest</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modality</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">EXPLAINER_KEY</span><span class="p">)</span>

    <span class="c1"># suggest postprocessor</span>
    <span class="n">modalities</span> <span class="o">=</span> <span class="n">format_into_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modality</span><span class="p">)</span>
    <span class="n">is_multi_modal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modalities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">postprocessor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pp</span><span class="p">,</span> <span class="n">modality</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">format_into_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessor</span><span class="p">),</span>
        <span class="n">modalities</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">force_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">explainer</span><span class="p">,</span> <span class="p">(</span><span class="n">Lime</span><span class="p">,</span> <span class="n">KernelShap</span><span class="p">))</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modality</span><span class="p">,</span> <span class="n">TextModality</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">force_params</span><span class="p">[</span><span class="s1">&#39;pooling_fn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">()</span>
        <span class="n">postprocessor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suggest</span><span class="p">(</span>
            <span class="n">trial</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="n">modality</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="n">generate_param_key</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">POSTPROCESSOR_KEY</span><span class="p">,</span>
                <span class="n">modality</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">is_multi_modal</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">force_params</span><span class="o">=</span><span class="n">force_params</span><span class="p">,</span>
        <span class="p">))</span>
    <span class="n">postprocessor</span> <span class="o">=</span> <span class="n">format_out_tuple_if_single</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">postprocessor</span><span class="p">))</span>

    <span class="c1"># Ignore duplicated samples</span>
    <span class="n">states_to_consider</span> <span class="o">=</span> <span class="p">(</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">,)</span>
    <span class="n">trials_to_consider</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">states_to_consider</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">trials_to_consider</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;explainer&#39;</span><span class="p">,</span> <span class="n">explainer</span><span class="p">)</span>
            <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;postprocessor&#39;</span><span class="p">,</span> <span class="n">postprocessor</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Explain and postprocess</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
    <span class="n">postprocessed</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">pp</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">format_into_tuple</span><span class="p">(</span><span class="n">postprocessor</span><span class="p">),</span>
            <span class="n">format_into_tuple</span><span class="p">(</span><span class="n">attrs</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">isnan</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pp</span><span class="o">.</span><span class="n">isinf</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">postprocessed</span><span class="p">):</span>
        <span class="c1"># Treat a failure as nan</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

    <span class="n">postprocessed</span> <span class="o">=</span> <span class="n">format_out_tuple_if_single</span><span class="p">(</span><span class="n">postprocessed</span><span class="p">)</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">set_explainer</span><span class="p">(</span><span class="n">explainer</span><span class="p">)</span>
    <span class="n">evals</span> <span class="o">=</span> <span class="n">format_into_tuple</span><span class="p">(</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">postprocessed</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Keep current explainer and postprocessor on trial</span>
    <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;explainer&#39;</span><span class="p">,</span> <span class="n">explainer</span><span class="p">)</span>
    <span class="n">trial</span><span class="o">.</span><span class="n">set_user_attr</span><span class="p">(</span><span class="s1">&#39;postprocessor&#39;</span><span class="p">,</span> <span class="n">postprocessor</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="o">*</span><span class="n">evals</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">evals</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pnpxai.evaluator.optimizer.objectives.Objective.set_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_data</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Sets both the input data and target labels for the objective.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>inputs</code></td>
            <td>
                  <code><span title="pnpxai.core._types.TensorOrTupleOfTensors">TensorOrTupleOfTensors</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data to be used by the explainer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>targets</code></td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target labels corresponding to the input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Objective</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated Objective instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pnpxai/evaluator/optimizer/objectives.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets both the input data and target labels for the objective.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        inputs (TensorOrTupleOfTensors): </span>
<span class="sd">            The input data to be used by the explainer.</span>
<span class="sd">        targets (Tensor): </span>
<span class="sd">            The target labels corresponding to the input data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Objective: The updated Objective instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_inputs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_targets</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pnpxai.evaluator.optimizer.objectives.Objective.set_inputs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_inputs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Sets the input data for the objective.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>inputs</code></td>
            <td>
                  <code><span title="pnpxai.core._types.TensorOrTupleOfTensors">TensorOrTupleOfTensors</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data to be used by the explainer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Objective</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated Objective instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pnpxai/evaluator/optimizer/objectives.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the input data for the objective.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        inputs (TensorOrTupleOfTensors): </span>
<span class="sd">            The input data to be used by the explainer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Objective: The updated Objective instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pnpxai.evaluator.optimizer.objectives.Objective.set_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_targets</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Sets the target labels for the objective.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>targets</code></td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target labels corresponding to the input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Objective</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated Objective instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pnpxai/evaluator/optimizer/objectives.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the target labels for the objective.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        targets (Tensor): </span>
<span class="sd">            The target labels corresponding to the input data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Objective: The updated Objective instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="pnpxai.evaluator.optimizer.suggestor"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="pnpxai.evaluator.optimizer.suggestor.suggest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">suggest</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">modality</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>A utility function that suggests parameters for a given object based on an optimization trial. 
The function recursively tunes the parameters of the object according to the modality (or 
modalities) provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>trial</code></td>
            <td>
                  <code><span title="optuna.Trial">Trial</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trial object from an optimization framework like Optuna, used to suggest 
parameters for tuning.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obj</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object whose parameters are being tuned. This object must implement 
<code>get_tunables()</code> and <code>set_kwargs()</code> methods.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>modality</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="pnpxai.core.modality.modality.Modality" href="../../core/modality/#pnpxai.core.modality.modality.Modality">Modality</a>, <span title="typing.Tuple">Tuple</span>[<a class="autorefs autorefs-internal" title="pnpxai.core.modality.modality.Modality" href="../../core/modality/#pnpxai.core.modality.modality.Modality">Modality</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modality (e.g., image, text) or tuple of modalities the object is operating on. 
If multiple modalities are provided, the function handles multi-modal tuning.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>key</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional key to uniquely identify the set of parameters being tuned, 
useful for differentiating parameters in multi-modal scenarios. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object with its parameters set according to the trial suggestions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function uses <code>map_suggest_method</code> to map the tuning method based on the method 
  type provided in the tunables.</li>
<li>It supports multi-modal tuning, where different modalities may require different 
  parameters to be tuned. </li>
<li>For utility functions (<code>UtilFunction</code>), the function further tunes parameters 
  based on the selected function from the modality.</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <p>Assuming <code>trial</code> is an instance of <code>optuna.trial.Trial</code>, and <code>explainer: Explainer</code> is an object 
with tunable parameters, you can tune it as follows:</p>
<pre><code class="language-python">tuned_explainer = suggest(trial, explainer, modality)
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>pnpxai/evaluator/optimizer/suggestor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">Trial</span><span class="p">,</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">modality</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Modality</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Modality</span><span class="p">]],</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A utility function that suggests parameters for a given object based on an optimization trial. </span>
<span class="sd">    The function recursively tunes the parameters of the object according to the modality (or </span>
<span class="sd">    modalities) provided.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        trial (Trial):</span>
<span class="sd">            The trial object from an optimization framework like Optuna, used to suggest </span>
<span class="sd">            parameters for tuning.</span>
<span class="sd">        obj (Any):</span>
<span class="sd">            The object whose parameters are being tuned. This object must implement </span>
<span class="sd">            `get_tunables()` and `set_kwargs()` methods.</span>
<span class="sd">        modality (Union[Modality, Tuple[Modality]]):</span>
<span class="sd">            The modality (e.g., image, text) or tuple of modalities the object is operating on. </span>
<span class="sd">            If multiple modalities are provided, the function handles multi-modal tuning.</span>
<span class="sd">        key (Optional[str], optional):</span>
<span class="sd">            An optional key to uniquely identify the set of parameters being tuned, </span>
<span class="sd">            useful for differentiating parameters in multi-modal scenarios. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any:</span>
<span class="sd">            The object with its parameters set according to the trial suggestions.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function uses `map_suggest_method` to map the tuning method based on the method </span>
<span class="sd">          type provided in the tunables.</span>
<span class="sd">        - It supports multi-modal tuning, where different modalities may require different </span>
<span class="sd">          parameters to be tuned. </span>
<span class="sd">        - For utility functions (`UtilFunction`), the function further tunes parameters </span>
<span class="sd">          based on the selected function from the modality.</span>

<span class="sd">    Example:</span>
<span class="sd">        Assuming `trial` is an instance of `optuna.trial.Trial`, and `explainer: Explainer` is an object </span>
<span class="sd">        with tunable parameters, you can tune it as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        tuned_explainer = suggest(trial, explainer, modality)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_multi_modal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_into_tuple</span><span class="p">(</span><span class="n">modality</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">force_params</span> <span class="o">=</span> <span class="n">force_params</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">param_nm</span><span class="p">,</span> <span class="p">(</span><span class="n">method_type</span><span class="p">,</span> <span class="n">method_kwargs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_tunables</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">param_nm</span> <span class="ow">in</span> <span class="n">force_params</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">force_params</span><span class="p">[</span><span class="n">param_nm</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">map_suggest_method</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">method_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">generate_param_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">param_nm</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">method_kwargs</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">method_type</span><span class="p">,</span> <span class="n">UtilFunction</span><span class="p">):</span>
                <span class="n">param</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">format_into_tuple</span><span class="p">(</span><span class="n">modality</span><span class="p">):</span>
                    <span class="n">fn_selector</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">map_fn_selector</span><span class="p">(</span><span class="n">method_type</span><span class="p">)</span>
                    <span class="n">_param_nm</span><span class="p">,</span> <span class="p">(</span><span class="n">_method_type</span><span class="p">,</span> <span class="n">_method_kwargs</span><span class="p">)</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="nb">iter</span><span class="p">(</span><span class="n">fn_selector</span><span class="o">.</span><span class="n">get_tunables</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                    <span class="p">)</span>
                    <span class="n">_param_nm</span> <span class="o">=</span> <span class="n">generate_param_key</span><span class="p">(</span>
                        <span class="n">param_nm</span><span class="p">,</span>
                        <span class="n">mod</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">is_multi_modal</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">_param_nm</span><span class="p">,</span>
                    <span class="p">)</span>  <span class="c1"># update param_nm</span>
                    <span class="n">_method</span> <span class="o">=</span> <span class="n">map_suggest_method</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">_method_type</span><span class="p">)</span>
                    <span class="n">fn_nm</span> <span class="o">=</span> <span class="n">_method</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">generate_param_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_param_nm</span><span class="p">),</span>
                        <span class="o">**</span><span class="n">_method_kwargs</span>
                    <span class="p">)</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="n">fn_selector</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn_nm</span><span class="p">)</span>
                    <span class="n">param</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suggest</span><span class="p">(</span>
                        <span class="n">trial</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span>
                        <span class="n">key</span><span class="o">=</span><span class="n">generate_param_key</span><span class="p">(</span>
                            <span class="n">key</span><span class="p">,</span> <span class="n">param_nm</span><span class="p">,</span>
                            <span class="n">mod</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">is_multi_modal</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="p">),</span>
                    <span class="p">))</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">format_out_tuple_if_single</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">set_kwargs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">param_nm</span><span class="p">:</span> <span class="n">param</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="pnpxai.evaluator.optimizer.types"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pnpxai.evaluator.optimizer.types.OptimizationOutput" class="doc doc-heading">
            <code>OptimizationOutput</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


      <p>A dataclass used to store the results of an optimization process, including the chosen 
explainer, postprocessor, and the Optuna study object that was used during the optimization.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pnpxai.evaluator.optimizer.types.OptimizationOutput.explainer">explainer</span></code></td>
            <td>
                  <code><span title="pnpxai.explainers.base.Explainer">Explainer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The explainer object selected during the optimization process. This object is 
responsible for generating explanations or attributions for a model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pnpxai.evaluator.optimizer.types.OptimizationOutput.postprocessor">postprocessor</span></code></td>
            <td>
                  <code><span title="pnpxai.explainers.utils.postprocess.PostProcessor">PostProcessor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The postprocessor object selected during the optimization process. This object 
is used to process the attributions generated by the explainer, often involving 
normalization or other transformations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pnpxai.evaluator.optimizer.types.OptimizationOutput.study">study</span></code></td>
            <td>
                  <code><span title="optuna.study.Study">Study</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Optuna study object that was used to conduct the optimization. This object 
contains information about the optimization trials and results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pnpxai/evaluator/optimizer/types.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizationOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dataclass used to store the results of an optimization process, including the chosen </span>
<span class="sd">    explainer, postprocessor, and the Optuna study object that was used during the optimization.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        explainer (Explainer):</span>
<span class="sd">            The explainer object selected during the optimization process. This object is </span>
<span class="sd">            responsible for generating explanations or attributions for a model.</span>
<span class="sd">        postprocessor (PostProcessor):</span>
<span class="sd">            The postprocessor object selected during the optimization process. This object </span>
<span class="sd">            is used to process the attributions generated by the explainer, often involving </span>
<span class="sd">            normalization or other transformations.</span>
<span class="sd">        study (optuna.study.Study):</span>
<span class="sd">            The Optuna study object that was used to conduct the optimization. This object </span>
<span class="sd">            contains information about the optimization trials and results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">explainer</span><span class="p">:</span> <span class="n">Explainer</span>
    <span class="n">postprocessor</span><span class="p">:</span> <span class="n">PostProcessor</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">optuna</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">Study</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.af256bd8.min.js"></script>
      
    
  </body>
</html>